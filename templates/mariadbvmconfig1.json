{
	"$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0", 

	"parameters": {
		"moodleCommon":	{ "type": "object", "metadata": { "description": "Common Moodle values" } }, 
		"vmName":		{ "type": "string", "metadata": { "description": "Name of VM to process script" } },
		"vmNumber":		{ "type": "int",	"metadata": { "description": "Number of the VM in the pool" } }
	},

	"variables": {
		"scriptUri":	"[concat(parameters('moodleCommon').ScriptLocation,parameters('moodleCommon').mariadbScriptFileName)]",
		"cmdExec":		"[concat('bash ', parameters('moodleCommon').mariadbScriptFileName,' ', parameters('moodleCommon').mariadbVmCount, ' ', parameters('moodleCommon').mySQLrootPassword,' ', parameters('moodleCommon').SubnetMdbPrefix, ' ', parameters('moodleCommon').mySQLuserPassword)]"
	},

	"resources": [
		{
			"type":			"Microsoft.Compute/virtualMachines/extensions",
			"apiVersion":	"2015-06-15",
			"name":			"[concat(parameters('vmName'),'/','install_mariadb')]",
			"location":		"[resourceGroup().location]",
					
			"tags":			{ "displayName": "install_mariadb" },

			"properties": {
				"publisher":				"Microsoft.OSTCExtensions",
				"type":						"CustomScriptForLinux",
				"typeHandlerVersion":		"1.4",
				"autoUpgradeMinorVersion":	true,
				"settings":					{ "fileUris": [ "[variables('scriptUri')]" ], "commandToExecute": "[variables('cmdExec')]" }
			}
		}
	]
}